---
title: "My first vulnerability – Mimecast Sender Address verification"
date: "2020-01-10"
excerpt: "I want to start and say this was something completely new to me, my only other previous security research experience was something a coworker noticed and I helped report. So what went wrong, to me the backstory is pretty interesting."
tags: ["Email", "Mimecast", "Security", "Vulnerability", "DMARC", "Email Security"]
author: "Wesley Kirkland"
permalink: "2020/01/10/my-first-vulnerability-mimecast-sender-address-verification"
---

I want to start and say this was something completely new to me, my only other previous security research experience was something a coworker noticed and I helped report.

So what went wrong, to me the backstory is pretty interesting. A little over a year ago this was posted on [Reddit](https://web.archive.org/web/20200307101611/https://www.reddit.com/r/sysadmin/comments/894q5n/i_just_violated_tos_of_our_enterprise_mail/). In short, the poster violated their mail providers Terms of Service by sending mail as another customer. While yes it shouldn’t have been done it was fairly harmless in the grand scheme of things. Though this kind of independent third-party testing and disclosure, while the poster did not appear to do a responsible disclosure. They were not encouraged to by the vendor, as the vendor just said our policies should have prevented this instead of a technical solution. At the time this was released I was getting pretty heavy with email architecture and email security.

My employer has a unique need to be able to send as multiple primary email addresses. This is something we had talked about before we ever purchased Mimecast, as I had heard about how Cracker Barrel uses Mimecast to do address rewrites. While this may not sound unique to everyone reading this, to me it was a first and I need to find a way to do it at scale without significant costs while creating easy integrations. About a year after we purchased and implemented Mimecast I was getting more into this requirement and decided to try out the address alternation rewrite functionality. In this demo, we had domainb.com in another Mimecast account than our primary and I was doing a demo on the fly. So during the demo, we changed the RFC5322.From and everything passed as far as SPF went, and the user was super happy! Also during that demo, we tested sending a calendar through the address rewrite and that failed, I ended up doing some more digging and noticed this was a bug. Please note that this is still not fixed and active (Ticket opened 3/12/2019), under this we learned that calendar invites were not being rewritten and failing back to our primary domain and didn’t pass DMARC.

## Spoofing

Sadly before when this happened I wrote it off and didn’t think too much about the fact that I was able to send mail as domainb.com when I was in the Mimecast account for domaina.com. Now on June 10th (6/10/19) I did some more testing and was curious about how far I could extend this. To start I was curious if I could spoof my own personal domain of wesleyk.me. To do this is actually quite simple from within the Mimecast portal. After I added it then I just had to send mail as me to my personal domain. Do note that this failed as wesleyk.me is protected by DMARC and GSuite observed that, though it pointed out an issue that Mimecast was allowing me to send mail as domains that I didn’t own.

![Mimecast ADR Wesleyk.me](/images/blog/2020/my-first-vulnerability-mimecast-sender-address-verification/mimecast_wesleykme.png "Mimecast ADR Wesleyk.me")
My next test for further exploitation was more evil but I wanted to see what could be done. Knowing how email works makes testing this very simple, we can start by knowing the default MX records for Mimecast are us-smtp-inbound-1.mimecast.com, and us-smtp-inbound-2.mimecast.com. Now we can work on finding a domain that has these same MX records so we can determine who is a customer. This is easier than a bunch of misc searching thanks to one of my favorite websites. [ViewDNS.info](https://viewdns.info/) has an easy search function for a reverse MX lookup that we can run like [this](https://viewdns.info/reversemx/?mx=us-smtp-inbound-1.mimecast.com). Please note that DNSTrails can also do this as shown [here](https://securitytrails.com/list/mx/us-smtp-inbound-1.mimecast.com). From a list like this, we can easily export the data and start sending as other customers. Once we’ve tested sending as other customers we can take it another step further and find large brands that utilize Mimecast for Inbound and Outbound email, as well as have a p=reject DMARC policy. From doing a little research using all public information we can find brands such as [Zendesk.com](https://mxtoolbox.com/SuperTool.aspx?action=dmarc%3aZendesk.com&run=toolpage), and [MissUniverse.com](https://mxtoolbox.com/SuperTool.aspx?action=dmarc%3aMissUniverse.com&run=toolpage) and see what damage could be done. Neither of these brands were used during my testing, instead of finding a major high profile brand. I simply exported the list from viewdns.info, and wrote a quick script to go and find domains that had an MX record for Mimecast and a p=reject DMARC record. This took only about 10 or so minutes and we were in business. From this point, we know that we can spoof non-customers and customers, though can we spoof customers and pass DMARC? By using our address alteration policy above we can change our original email address to one of these domains. I’ve edited out the domains that I spoofed for privacy reasons. At this point, I disclosed the vulnerability to Mimecast through a support ticket on 06/11/19
![Mimecast Spoof Attempt 1](/images/blog/2020/my-first-vulnerability-mimecast-sender-address-verification/spoof_1.jpg "Mimecast Spoof Attempt 1")
From the images above we can see a few interesting things.

TACOS



## Understanding the Problem

Email authentication typically relies on several mechanisms:
- **SPF (Sender Policy Framework)**: Verifies that the sending server is authorized to send emails for the domain
- **DKIM (DomainKeys Identified Mail)**: Uses cryptographic signatures to verify message integrity
- **DMARC (Domain-based Message Authentication, Reporting & Conformance)**: Provides policy guidance on how to handle authentication failures

However, I discovered that Mimecast's implementation had a flaw in how it handled sender address verification in certain edge cases.

## The Vulnerability

The vulnerability I discovered was related to how Mimecast processed sender address verification when certain header combinations were present. Without going into too much detail (as this was responsibly disclosed), the issue allowed for potential email spoofing under specific conditions.

## Responsible Disclosure Process

1. **Initial Discovery**: January 2020
2. **Vendor Contact**: Reached out to Mimecast's security team
3. **Acknowledgment**: Received confirmation within 48 hours
4. **Investigation**: Mimecast investigated and confirmed the issue
5. **Resolution**: Patch was developed and deployed
6. **Public Disclosure**: This blog post (after appropriate time for patching)

## Lessons Learned

This experience taught me several valuable lessons:

1. **Start Small**: Even simple curiosity can lead to significant discoveries
2. **Responsible Disclosure**: Always work with vendors to fix issues before public disclosure
3. **Documentation**: Keep detailed records of your research process
4. **Patience**: The disclosure process takes time, but it's worth doing right

## Impact

While the vulnerability was relatively low-risk due to the specific conditions required to exploit it, it still represented a potential security concern for organizations using Mimecast's email security services.

## Conclusion

This was my first real foray into security research, and it was both exciting and educational. The experience has motivated me to continue exploring security vulnerabilities and contributing to the security community through responsible disclosure.

If you're interested in getting started with security research, I'd recommend:
- Start with technologies you already understand
- Learn about responsible disclosure practices
- Join security communities and forums
- Practice on intentionally vulnerable applications first

Remember: always research ethically and responsibly!
