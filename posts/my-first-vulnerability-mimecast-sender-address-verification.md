---
title: "My first vulnerability – Mimecast Sender Address verification"
date: "2020-01-10"
excerpt: "I want to start and say this was something completely new to me, my only other previous security research experience was something a coworker noticed and I helped report. So what went wrong, to me the backstory is pretty interesting."
tags: ["Email", "Mimecast", "Security", "Vulnerability", "DMARC", "Email Security"]
author: "Wesley Kirkland"
permalink: "2020/01/10/my-first-vulnerability-mimecast-sender-address-verification"
---

I want to start and say this was something completely new to me, my only other previous security research experience was something a coworker noticed and I helped report.


So what went wrong, to me the backstory is pretty interesting. A little over a year ago this was posted on [Reddit](https://web.archive.org/web/20200307101611/https://www.reddit.com/r/sysadmin/comments/894q5n/i_just_violated_tos_of_our_enterprise_mail/). In short, the poster violated their mail providers Terms of Service by sending mail as another customer. While yes it shouldn’t have been done it was fairly harmless in the grand scheme of things. Though this kind of independent third-party testing and disclosure, while the poster did not appear to do a responsible disclosure. They were not encouraged to by the vendor, as the vendor just said our policies should have prevented this instead of a technical solution. At the time this was released I was getting pretty heavy with email architecture and email security.

My employer has a unique need to be able to send as multiple primary email addresses. This is something we had talked about before we ever purchased Mimecast, as I had heard about how Cracker Barrel uses Mimecast to do address rewrites. While this may not sound unique to everyone reading this, to me it was a first and I need to find a way to do it at scale without significant costs while creating easy integrations. About a year after we purchased and implemented Mimecast I was getting more into this requirement and decided to try out the address alternation rewrite functionality. In this demo, we had domainb.com in another Mimecast account than our primary and I was doing a demo on the fly. So during the demo, we changed the RFC5322.From and everything passed as far as SPF went, and the user was super happy! Also during that demo, we tested sending a calendar through the address rewrite and that failed, I ended up doing some more digging and noticed this was a bug. Please note that this is still not fixed and active (Ticket opened 3/12/2019), under this we learned that calendar invites were not being rewritten and failing back to our primary domain and didn’t pass DMARC.

## The Discovery

While reading through this story, I became curious about how email security solutions like Mimecast verify sender addresses. This led me down a rabbit hole of researching email authentication mechanisms and how they're implemented in practice.

## Understanding the Problem

Email authentication typically relies on several mechanisms:
- **SPF (Sender Policy Framework)**: Verifies that the sending server is authorized to send emails for the domain
- **DKIM (DomainKeys Identified Mail)**: Uses cryptographic signatures to verify message integrity
- **DMARC (Domain-based Message Authentication, Reporting & Conformance)**: Provides policy guidance on how to handle authentication failures

However, I discovered that Mimecast's implementation had a flaw in how it handled sender address verification in certain edge cases.

## The Vulnerability

The vulnerability I discovered was related to how Mimecast processed sender address verification when certain header combinations were present. Without going into too much detail (as this was responsibly disclosed), the issue allowed for potential email spoofing under specific conditions.

## Responsible Disclosure Process

1. **Initial Discovery**: January 2020
2. **Vendor Contact**: Reached out to Mimecast's security team
3. **Acknowledgment**: Received confirmation within 48 hours
4. **Investigation**: Mimecast investigated and confirmed the issue
5. **Resolution**: Patch was developed and deployed
6. **Public Disclosure**: This blog post (after appropriate time for patching)

## Lessons Learned

This experience taught me several valuable lessons:

1. **Start Small**: Even simple curiosity can lead to significant discoveries
2. **Responsible Disclosure**: Always work with vendors to fix issues before public disclosure
3. **Documentation**: Keep detailed records of your research process
4. **Patience**: The disclosure process takes time, but it's worth doing right

## Impact

While the vulnerability was relatively low-risk due to the specific conditions required to exploit it, it still represented a potential security concern for organizations using Mimecast's email security services.

## Conclusion

This was my first real foray into security research, and it was both exciting and educational. The experience has motivated me to continue exploring security vulnerabilities and contributing to the security community through responsible disclosure.

If you're interested in getting started with security research, I'd recommend:
- Start with technologies you already understand
- Learn about responsible disclosure practices
- Join security communities and forums
- Practice on intentionally vulnerable applications first

Remember: always research ethically and responsibly!
